kube-prometheus-stack:
  grafana:
    admin:
      existingSecret: "grafana-secrets"
    smtp:
      existingSecret: "grafana-secrets"
    additionalDataSources:
    - access: proxy
      isDefault: false
      name: Loki
      type: loki
      url: http://loki.default:3100
    dashboardProviders:
      dashboardproviders.yaml:
        apiVersion: 1
        providers:
          - name: 'default'
            orgId: 1
            folder: ''
            type: file
            disableDeletion: false
            editable: true
            options:
              path: /var/lib/grafana/dashboards/default
    dashboards:
      default:
        loki:
          gnetId: 13639
          revision: 2
          datasource:
            - name: DS_LOKI
              value: Loki
  additionalPrometheusRules:
    - name: loki-alert
      groups:
        - name: spritstat
          rules:
            - alert: spritstat_errors
              expr: sum(increase(promtail_custom_spritstat_errors[15m])) > 2
              for: 30m
              annotations:
                message: 'total spritstat error count ({{ $value }}).'
#  alertmanager:
#    config:
#      global:
#        resolve_timeout: 5m
#      route:
#        group_by: [ 'alertname' ]
#        group_wait: 3s
#        group_interval: 5s
#        repeat_interval: 1m
#        receiver: webhook-alert
#        routes:
#          - match:
#              alertname: spritstat_errors
#            receiver: webhook-alert
#      receivers:
#        - name: 'webhook-alert'
#          webhook_configs:
#            - url: 'http://dingtalk-hook:5000'
#              send_resolved: true